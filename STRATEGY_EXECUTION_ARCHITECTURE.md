# ç­–ç•¥æ‰§è¡Œå¼•æ“æ¶æ„è®¾è®¡

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

å®ç°ä¸€ä¸ªå¼ºå¤§ã€çµæ´»ã€å¯æ‰©å±•çš„ç­–ç•¥æ‰§è¡Œå¼•æ“ï¼Œæ”¯æŒï¼š

1. **çµæ´»çš„è‚¡ç¥¨èŒƒå›´é€‰æ‹©** - å…¨é‡è‚¡ç¥¨ã€è¡Œä¸šç­›é€‰ã€æ¦‚å¿µé€‰æ‹©ã€æŒ‡æ•°æˆåˆ†è‚¡ã€è‡ªå®šä¹‰è‚¡ç¥¨æ± 
2. **æ™ºèƒ½æ•°æ®è·å–ä¸ç»„è£…** - æŒ‰å› å­éœ€æ±‚å®æ—¶ä»Tushareæ‹‰å–æ•°æ®ï¼Œæ”¯æŒç¼“å­˜å’Œå¹¶å‘ä¼˜åŒ–
3. **å®Œæ•´çš„æ‰§è¡Œæ—¥å¿—** - æä¾›è¯¦ç»†çš„æ‰§è¡Œè¿‡ç¨‹ç›‘æ§ï¼Œè®©ç”¨æˆ·äº†è§£æ¯ä¸ªæ­¥éª¤çš„è¿›å±•

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç­–ç•¥æ‰§è¡Œå¼•æ“æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŒ Frontend Layer                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ è‚¡ç¥¨èŒƒå›´é€‰æ‹©UI â”‚ â”‚ å®æ—¶æ‰§è¡Œç›‘æ§UI â”‚ â”‚ æ—¥å¿—æŸ¥çœ‹ç»„ä»¶   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”Œ API Gateway Layer                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ /strategy-execution/* - ç­–ç•¥æ‰§è¡ŒAPIæ¥å£                      â”‚ â”‚
â”‚  â”‚ â€¢ POST /{id}/execute - å¼‚æ­¥æ‰§è¡Œç­–ç•¥                         â”‚ â”‚
â”‚  â”‚ â€¢ GET /executions/{id}/progress - è·å–æ‰§è¡Œè¿›åº¦              â”‚ â”‚
â”‚  â”‚ â€¢ GET /executions/{id}/logs - è·å–æ‰§è¡Œæ—¥å¿—                  â”‚ â”‚
â”‚  â”‚ â€¢ POST /validate-filter - éªŒè¯ç­›é€‰æ¡ä»¶                      â”‚ â”‚
â”‚  â”‚ â€¢ GET /scopes - è·å–å¯ç”¨è‚¡ç¥¨èŒƒå›´é€‰é¡¹                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ§  Business Logic Layer                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ æ‰§è¡Œæ§åˆ¶å™¨    â”‚ â”‚ è‚¡ç¥¨ç­›é€‰å™¨    â”‚ â”‚ æ•°æ®è·å–å™¨    â”‚        â”‚
â”‚  â”‚ ExecutionEngineâ”‚ â”‚ StockFilter   â”‚ â”‚ DataFetcher   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ å› å­è®¡ç®—å™¨    â”‚ â”‚ è‚¡ç¥¨é€‰æ‹©å™¨    â”‚ â”‚ æ—¥å¿—è®°å½•å™¨    â”‚        â”‚
â”‚  â”‚ FactorCalc    â”‚ â”‚ StockSelector â”‚ â”‚ Logger        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ è¿›åº¦è·Ÿè¸ªå™¨    â”‚ â”‚ ç¼“å­˜ç®¡ç†å™¨    â”‚ â”‚ é”™è¯¯å¤„ç†å™¨    â”‚        â”‚
â”‚  â”‚ ProgressTrackerâ”‚ â”‚ CacheService  â”‚ â”‚ ErrorHandler  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¾ Data Access Layer                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Tushare API   â”‚ â”‚ æœ¬åœ°æ•°æ®åº“    â”‚ â”‚ å› å­åº“        â”‚        â”‚
â”‚  â”‚ å®æ—¶æ•°æ®æ‹‰å–  â”‚ â”‚ ç­–ç•¥æ‰§è¡Œè®°å½•  â”‚ â”‚ å› å­å®šä¹‰ç®¡ç†  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. ç­–ç•¥æ‰§è¡Œå¼•æ“ (StrategyExecutionEngine)

**èŒè´£**: ç­–ç•¥æ‰§è¡Œçš„æ€»æ§åˆ¶å™¨

**æ ¸å¿ƒåŠŸèƒ½**:
- æ‰§è¡Œæµç¨‹ç¼–æ’ï¼š6ä¸ªå…³é”®é˜¶æ®µçš„é¡ºåºæ‰§è¡Œ
- å¹¶å‘æ§åˆ¶ï¼šç®¡ç†åŒæ—¶æ‰§è¡Œçš„ç­–ç•¥æ•°é‡
- çŠ¶æ€ç®¡ç†ï¼šè·Ÿè¸ªæ‰§è¡ŒçŠ¶æ€å’Œè¿›åº¦
- é”™è¯¯å¤„ç†ï¼šå¼‚å¸¸æ•è·å’Œæ¢å¤æœºåˆ¶

**æ‰§è¡Œé˜¶æ®µ**:
```python
1. initialization (5%)      - åˆå§‹åŒ–éªŒè¯
2. stock_filtering (10%)    - è‚¡ç¥¨æ± ç­›é€‰
3. data_fetching (40%)      - æ•°æ®è·å–
4. factor_calculation (35%) - å› å­è®¡ç®—
5. ranking_selection (8%)   - æ’åºé€‰è‚¡
6. finalization (2%)        - ç»“æœæ•´ç†
```

### 2. è‚¡ç¥¨ç­›é€‰å™¨ (StockFilter)

**æ”¯æŒçš„ç­›é€‰èŒƒå›´**:
```python
class StockScope:
    ALL = "all"                # å…¨éƒ¨Aè‚¡ï¼ˆçº¦5000åªï¼‰
    INDUSTRY = "industry"      # æŒ‰ç”³ä¸‡è¡Œä¸šåˆ†ç±»
    CONCEPT = "concept"        # æŒ‰æ¦‚å¿µä¸»é¢˜åˆ†ç±»
    INDEX = "index"            # æŒ‡æ•°æˆåˆ†è‚¡
    CUSTOM = "custom"          # ç”¨æˆ·è‡ªå®šä¹‰è‚¡ç¥¨åˆ—è¡¨
```

**ç­›é€‰æ¡ä»¶**:
- **å¸‚åœºç±»å‹**: ä¸»æ¿ã€ä¸­å°æ¿ã€åˆ›ä¸šæ¿ã€ç§‘åˆ›æ¿ã€åŒ—äº¤æ‰€
- **åŸºç¡€æŒ‡æ ‡**: å¸‚å€¼èŒƒå›´ã€è‚¡ä»·èŒƒå›´ã€æ¢æ‰‹ç‡èŒƒå›´
- **ç‰¹æ®Šæ¡ä»¶**: æ’é™¤STã€æ’é™¤æ–°è‚¡ã€æ’é™¤åœç‰Œ
- **è¡Œä¸šæ¦‚å¿µ**: æŒ‡å®šåŒ…å«/æ’é™¤çš„è¡Œä¸šå’Œæ¦‚å¿µ

### 3. æ•°æ®è·å–å™¨ (DataFetcher)

**æ™ºèƒ½æ•°æ®è·å–ç­–ç•¥**:
```python
async def fetch_stock_data(self, stock_codes, required_fields, trade_date):
    """
    æ™ºèƒ½æ•°æ®è·å–æµç¨‹:
    1. åˆ†æå› å­éœ€æ±‚ï¼Œç¡®å®šæ‰€éœ€æ•°æ®å­—æ®µ
    2. æ£€æŸ¥ç¼“å­˜ï¼Œå‡å°‘APIè°ƒç”¨
    3. åˆ†æ‰¹è·å–ï¼Œé¿å…APIé™åˆ¶
    4. å¹¶å‘å¤„ç†ï¼Œæå‡è·å–é€Ÿåº¦
    5. æ•°æ®éªŒè¯ï¼Œç¡®ä¿è´¨é‡
    """
```

**ç¼“å­˜ç­–ç•¥**:
- **L1ç¼“å­˜**: å†…å­˜ç¼“å­˜ï¼Œ1å°æ—¶æœ‰æ•ˆæœŸ
- **é”®å€¼è®¾è®¡**: `stock_data_{date}_{fields_hash}`
- **æ·˜æ±°ç­–ç•¥**: LRUç®—æ³•ï¼Œæœ€å¤§1000é¡¹
- **å‘½ä¸­ç‡ç›‘æ§**: å®æ—¶ç»Ÿè®¡ç¼“å­˜æ•ˆç‡

**Tushareé›†æˆ**:
```python
# æ ¹æ®å› å­éœ€æ±‚åŠ¨æ€è·å–å­—æ®µ
required_fields = await self._analyze_factor_requirements(strategy)

# åˆ†æ‰¹APIè°ƒç”¨ï¼Œé¿å…é™åˆ¶
batch_size = 100  # æ¯æ‰¹100åªè‚¡ç¥¨
for batch in batches:
    data = await tushare_service.get_daily_data(
        ts_codes=batch,
        fields=required_fields,
        trade_date=execution_date
    )
```

### 4. å› å­è®¡ç®—å™¨ (FactorCalculator)

**è®¡ç®—å¼•æ“**:
```python
async def calculate_factors(self, strategy, stock_data):
    """
    å› å­è®¡ç®—æµç¨‹:
    1. éå†ç­–ç•¥ä¸­çš„å¯ç”¨å› å­
    2. è·å–å› å­å®šä¹‰å’Œå…¬å¼
    3. å‡†å¤‡è®¡ç®—æ‰€éœ€æ•°æ®
    4. æ‰§è¡Œå› å­è®¡ç®—å…¬å¼
    5. ç»Ÿè®¡è®¡ç®—ç»“æœå’Œæ€§èƒ½
    """
```

**æ”¯æŒçš„å› å­ç±»å‹**:
- **æŠ€æœ¯æŒ‡æ ‡**: MAã€RSIã€MACDã€å¸ƒæ—å¸¦ç­‰
- **åŸºæœ¬é¢å› å­**: PEã€PBã€ROEã€ROAç­‰  
- **é‡ä»·å› å­**: æˆäº¤é‡ã€æ¢æ‰‹ç‡ã€ä»·æ ¼åŠ¨é‡ç­‰
- **è‡ªå®šä¹‰å› å­**: ç”¨æˆ·ç¼–å†™çš„Pythonå…¬å¼

### 5. æ‰§è¡Œæ—¥å¿—ç³»ç»Ÿ (ExecutionLogger)

**æ—¥å¿—çº§åˆ«**:
```python
class LogLevel:
    INFO = "info"         # ä¸€èˆ¬ä¿¡æ¯
    WARNING = "warning"   # è­¦å‘Šä¿¡æ¯
    ERROR = "error"       # é”™è¯¯ä¿¡æ¯
    DEBUG = "debug"       # è°ƒè¯•ä¿¡æ¯
```

**æ—¥å¿—å†…å®¹**:
```python
class ExecutionLog:
    timestamp: datetime   # æ—¶é—´æˆ³
    level: LogLevel      # æ—¥å¿—çº§åˆ«
    stage: str           # æ‰§è¡Œé˜¶æ®µ
    message: str         # æ—¥å¿—æ¶ˆæ¯
    details: dict        # è¯¦ç»†ä¿¡æ¯
    progress: float      # è¿›åº¦ç™¾åˆ†æ¯”
```

### 6. è¿›åº¦è·Ÿè¸ªå™¨ (ProgressTracker)

**é˜¶æ®µæƒé‡åˆ†é…**:
```python
stage_weights = {
    "initialization": 5,        # åˆå§‹åŒ–
    "stock_filtering": 10,      # è‚¡ç¥¨ç­›é€‰
    "data_fetching": 40,        # æ•°æ®è·å–ï¼ˆæœ€è€—æ—¶ï¼‰
    "factor_calculation": 35,   # å› å­è®¡ç®—
    "ranking_selection": 8,     # æ’åºé€‰è‚¡
    "finalization": 2          # ç»“æœæ•´ç†
}
```

**å®æ—¶è¿›åº¦è®¡ç®—**:
```python
def get_overall_progress(self) -> float:
    """åŠ æƒè®¡ç®—æ€»ä½“è¿›åº¦"""
    weighted_progress = sum(
        stage.progress * weight 
        for stage, weight in stage_weights.items()
    )
    return weighted_progress / sum(stage_weights.values())
```

## ğŸ“Š æ•°æ®æµè®¾è®¡

### è¾“å…¥æ•°æ®æµ
```
ç”¨æˆ·é€‰æ‹©ç­–ç•¥ â†’ é…ç½®è‚¡ç¥¨èŒƒå›´ â†’ è®¾ç½®ç­›é€‰æ¡ä»¶ â†’ æäº¤æ‰§è¡Œè¯·æ±‚
      â†“
è‚¡ç¥¨æ± ç­›é€‰ â†’ è·å–è‚¡ç¥¨åˆ—è¡¨ â†’ åˆ†æå› å­éœ€æ±‚ â†’ ç¡®å®šæ•°æ®å­—æ®µ
      â†“
Tushare APIè°ƒç”¨ â†’ æ•°æ®è·å– â†’ ç¼“å­˜å­˜å‚¨ â†’ æ•°æ®éªŒè¯
      â†“
å› å­è®¡ç®— â†’ å¾—åˆ†è®¡ç®— â†’ æƒé‡åˆæˆ â†’ æ’åºç­›é€‰
      â†“
ç»“æœè¾“å‡º â†’ æ•°æ®åº“å­˜å‚¨ â†’ å‰ç«¯å±•ç¤º
```

### æ‰§è¡ŒçŠ¶æ€æµ
```
PENDING â†’ RUNNING â†’ DATA_FETCHING â†’ FACTOR_CALCULATING 
   â†“         â†“            â†“              â†“
RANKING â†’ FILTERING â†’ COMPLETED/FAILED/CANCELLED
```

## ğŸ¨ å‰ç«¯ç•Œé¢è®¾è®¡

### 1. è‚¡ç¥¨èŒƒå›´é€‰æ‹©ç•Œé¢

**å¡ç‰‡å¼é€‰æ‹©**:
```typescript
const STOCK_SCOPES = [
  { 
    value: 'all', 
    label: 'å…¨éƒ¨è‚¡ç¥¨', 
    description: 'æ‰€æœ‰Aè‚¡å¸‚åœºè‚¡ç¥¨',
    icon: 'ğŸŒ'
  },
  { 
    value: 'industry', 
    label: 'æŒ‰è¡Œä¸šç­›é€‰', 
    description: 'é€‰æ‹©ç‰¹å®šè¡Œä¸šçš„è‚¡ç¥¨',
    icon: 'ğŸ­'
  },
  // ... æ›´å¤šé€‰é¡¹
];
```

**åŠ¨æ€é€‰é¡¹åŠ è½½**:
```typescript
// æ ¹æ®é€‰æ‹©çš„èŒƒå›´åŠ¨æ€åŠ è½½ç›¸åº”é€‰é¡¹
useEffect(() => {
  if (scope === 'industry') {
    loadIndustries();
  } else if (scope === 'concept') {
    loadConcepts();
  }
}, [scope]);
```

### 2. å®æ—¶æ‰§è¡Œç›‘æ§

**è¿›åº¦æ¡å±•ç¤º**:
```tsx
<div className="w-full bg-base-300 rounded-full h-2">
  <div 
    className="bg-primary h-2 rounded-full transition-all duration-300"
    style={{ width: `${progress}%` }}
  />
</div>
```

**çŠ¶æ€æŒ‡ç¤ºå™¨**:
```tsx
const STATUS_MAP = {
  'data_fetching': { label: 'æ•°æ®è·å–ä¸­', color: 'text-info' },
  'factor_calculating': { label: 'å› å­è®¡ç®—ä¸­', color: 'text-info' },
  'completed': { label: 'æ‰§è¡Œå®Œæˆ', color: 'text-success' },
  'failed': { label: 'æ‰§è¡Œå¤±è´¥', color: 'text-error' }
};
```

### 3. æ—¥å¿—ç›‘æ§ç•Œé¢

**å®æ—¶æ—¥å¿—æµ**:
```tsx
// 1ç§’è½®è¯¢è·å–æœ€æ–°æ—¥å¿—
useEffect(() => {
  const interval = setInterval(() => {
    if (executionId && isExecuting) {
      fetchExecutionLogs();
    }
  }, 1000);
  return () => clearInterval(interval);
}, [executionId, isExecuting]);
```

**æ—¥å¿—çº§åˆ«è¿‡æ»¤**:
```tsx
<select onChange={(e) => setLogLevel(e.target.value)}>
  <option value="">å…¨éƒ¨çº§åˆ«</option>
  <option value="info">ä¿¡æ¯</option>
  <option value="warning">è­¦å‘Š</option>
  <option value="error">é”™è¯¯</option>
</select>
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æ•°æ®è·å–ä¼˜åŒ–

**åˆ†æ‰¹å¤„ç†**:
```python
batch_size = 100  # æ¯æ‰¹100åªè‚¡ç¥¨
batches = [stocks[i:i + batch_size] for i in range(0, len(stocks), batch_size)]

# å¹¶å‘å¤„ç†å¤šä¸ªæ‰¹æ¬¡
async with aiohttp.ClientSession() as session:
    tasks = [fetch_batch(session, batch) for batch in batches]
    results = await asyncio.gather(*tasks)
```

**æ™ºèƒ½ç¼“å­˜**:
```python
# ç¼“å­˜é”®è®¾è®¡
cache_key = f"daily_data_{trade_date}_{hash(tuple(sorted(fields)))}"

# åˆ†å±‚ç¼“å­˜ç­–ç•¥
if cache_key in memory_cache:
    return memory_cache[cache_key]
elif cache_key in redis_cache:
    data = redis_cache.get(cache_key)
    memory_cache[cache_key] = data
    return data
else:
    data = await fetch_from_tushare()
    memory_cache[cache_key] = data
    redis_cache.set(cache_key, data, expire=3600)
    return data
```

### 2. å› å­è®¡ç®—ä¼˜åŒ–

**å‘é‡åŒ–è®¡ç®—**:
```python
# ä½¿ç”¨pandaså‘é‡åŒ–æ“ä½œæ›¿ä»£å¾ªç¯
def calculate_momentum_factor(data):
    # é¿å…: forå¾ªç¯è®¡ç®—æ¯åªè‚¡ç¥¨
    # ä½¿ç”¨: å‘é‡åŒ–è®¡ç®—
    return (data['close'] / data['close'].shift(20) - 1).fillna(0)
```

**å¹¶è¡Œè®¡ç®—**:
```python
# å¤šè¿›ç¨‹å¹¶è¡Œè®¡ç®—ä¸åŒå› å­
from concurrent.futures import ProcessPoolExecutor

async def calculate_factors_parallel(strategy, stock_data):
    with ProcessPoolExecutor(max_workers=4) as executor:
        tasks = []
        for factor in strategy.factors:
            if factor.is_enabled:
                task = executor.submit(calculate_single_factor, factor, stock_data)
                tasks.append(task)
        
        results = await asyncio.gather(*tasks)
        return dict(zip([f.factor_id for f in strategy.factors], results))
```

### 3. å†…å­˜ç®¡ç†

**æ•°æ®åˆ†å—å¤„ç†**:
```python
def process_large_dataset(data, chunk_size=10000):
    """åˆ†å—å¤„ç†å¤§æ•°æ®é›†ï¼Œé¿å…å†…å­˜æº¢å‡º"""
    for i in range(0, len(data), chunk_size):
        chunk = data[i:i + chunk_size]
        yield process_chunk(chunk)
```

**åŠæ—¶æ¸…ç†**:
```python
# è®¡ç®—å®Œæˆåç«‹å³æ¸…ç†å¤§å¯¹è±¡
del large_dataframe
gc.collect()
```

## ğŸ”’ é”™è¯¯å¤„ç†ä¸å®¹é”™

### 1. åˆ†å±‚é”™è¯¯å¤„ç†

**ç½‘ç»œå±‚é”™è¯¯**:
```python
async def fetch_with_retry(url, max_retries=3):
    for attempt in range(max_retries):
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get(url) as response:
                    return await response.json()
        except aiohttp.ClientError as e:
            if attempt == max_retries - 1:
                raise
            await asyncio.sleep(2 ** attempt)  # æŒ‡æ•°é€€é¿
```

**æ•°æ®éªŒè¯é”™è¯¯**:
```python
def validate_stock_data(data):
    """éªŒè¯è‚¡ç¥¨æ•°æ®å®Œæ•´æ€§"""
    if data.empty:
        raise DataValidationError("è‚¡ç¥¨æ•°æ®ä¸ºç©º")
    
    required_fields = ['ts_code', 'trade_date', 'close']
    missing_fields = [f for f in required_fields if f not in data.columns]
    if missing_fields:
        raise DataValidationError(f"ç¼ºå°‘å¿…è¦å­—æ®µ: {missing_fields}")
    
    if data['close'].isna().all():
        raise DataValidationError("æ”¶ç›˜ä»·æ•°æ®å…¨éƒ¨ä¸ºç©º")
```

**å› å­è®¡ç®—é”™è¯¯**:
```python
async def calculate_factor_safe(factor_def, stock_data):
    """å®‰å…¨çš„å› å­è®¡ç®—ï¼Œæ•è·å¹¶è®°å½•é”™è¯¯"""
    try:
        return await calculate_factor(factor_def, stock_data)
    except ZeroDivisionError:
        logger.warning(f"å› å­ {factor_def.id} è®¡ç®—å‡ºç°é™¤é›¶é”™è¯¯")
        return pd.Series(index=stock_data.index, data=np.nan)
    except Exception as e:
        logger.error(f"å› å­ {factor_def.id} è®¡ç®—å¤±è´¥: {e}")
        return pd.Series(index=stock_data.index, data=np.nan)
```

### 2. ä¼˜é›…é™çº§

**éƒ¨åˆ†å¤±è´¥å¤„ç†**:
```python
# å³ä½¿éƒ¨åˆ†è‚¡ç¥¨æ•°æ®è·å–å¤±è´¥ï¼Œä¹Ÿç»§ç»­å¤„ç†æˆåŠŸçš„éƒ¨åˆ†
if len(failed_stocks) > 0:
    logger.warning(f"éƒ¨åˆ†è‚¡ç¥¨æ•°æ®è·å–å¤±è´¥: {len(failed_stocks)}åª")
    
if len(successful_data) > 0:
    logger.info(f"ç»§ç»­å¤„ç†æˆåŠŸè·å–çš„æ•°æ®: {len(successful_data)}åª")
    continue_execution(successful_data)
else:
    raise ExecutionError("æ‰€æœ‰è‚¡ç¥¨æ•°æ®è·å–å¤±è´¥")
```

## ğŸ“ˆ ç›‘æ§ä¸æŒ‡æ ‡

### 1. æ‰§è¡Œæ€§èƒ½æŒ‡æ ‡

```python
class ExecutionMetrics:
    total_time: float           # æ€»æ‰§è¡Œæ—¶é—´
    data_fetch_time: float      # æ•°æ®è·å–æ—¶é—´
    factor_calc_time: float     # å› å­è®¡ç®—æ—¶é—´
    stock_count: int            # å¤„ç†è‚¡ç¥¨æ•°é‡
    cache_hit_rate: float       # ç¼“å­˜å‘½ä¸­ç‡
    api_call_count: int         # APIè°ƒç”¨æ¬¡æ•°
    success_rate: float         # æˆåŠŸç‡
```

### 2. å®æ—¶ç›‘æ§

**æ‰§è¡ŒçŠ¶æ€ç›‘æ§**:
```python
# WebSocketå®æ—¶æ¨é€æ‰§è¡Œè¿›åº¦
@websocket_route("/ws/execution/{execution_id}")
async def execution_websocket(websocket, execution_id):
    while execution_id in running_executions:
        progress = get_execution_progress(execution_id)
        await websocket.send_json({
            "type": "progress_update",
            "data": progress.dict()
        })
        await asyncio.sleep(1)
```

**ç³»ç»Ÿèµ„æºç›‘æ§**:
```python
import psutil

def get_system_metrics():
    return {
        "cpu_usage": psutil.cpu_percent(),
        "memory_usage": psutil.virtual_memory().percent,
        "disk_usage": psutil.disk_usage('/').percent,
        "active_executions": len(running_executions)
    }
```

## ğŸ”® æ‰©å±•æ€§è®¾è®¡

### 1. æ’ä»¶åŒ–å› å­è®¡ç®—

```python
class FactorPlugin:
    """å› å­è®¡ç®—æ’ä»¶åŸºç±»"""
    
    @abstractmethod
    async def calculate(self, stock_data: pd.DataFrame) -> pd.Series:
        pass
    
    @property
    @abstractmethod
    def required_fields(self) -> List[str]:
        pass

# æ³¨å†Œè‡ªå®šä¹‰å› å­
@register_factor_plugin("custom_momentum")
class CustomMomentumFactor(FactorPlugin):
    async def calculate(self, stock_data):
        return calculate_custom_momentum(stock_data)
```

### 2. å¤šæ•°æ®æºæ”¯æŒ

```python
class DataSource:
    """æ•°æ®æºæŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    async def fetch_data(self, symbols, fields, date) -> pd.DataFrame:
        pass

class TushareDataSource(DataSource):
    async def fetch_data(self, symbols, fields, date):
        return await tushare_client.get_data(symbols, fields, date)

class WindDataSource(DataSource):
    async def fetch_data(self, symbols, fields, date):
        return await wind_client.get_data(symbols, fields, date)
```

### 3. åˆ†å¸ƒå¼æ‰§è¡Œ

```python
# ä½¿ç”¨Celeryå®ç°åˆ†å¸ƒå¼æ‰§è¡Œ
from celery import Celery

app = Celery('strategy_execution')

@app.task
def execute_strategy_task(strategy_id, execution_config):
    """å¼‚æ­¥æ‰§è¡Œç­–ç•¥ä»»åŠ¡"""
    return strategy_execution_engine.execute_strategy(
        strategy_id, execution_config
    )

# ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª
def get_task_progress(task_id):
    result = execute_strategy_task.AsyncResult(task_id)
    return {
        "state": result.state,
        "progress": result.info.get('progress', 0),
        "logs": result.info.get('logs', [])
    }
```

## ğŸ¯ æ€»ç»“

è¿™å¥—ç­–ç•¥æ‰§è¡Œå¼•æ“æ¶æ„å…·å¤‡ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼š

### âœ… åŠŸèƒ½å®Œæ•´æ€§
- **å…¨é¢çš„è‚¡ç¥¨ç­›é€‰**: æ”¯æŒå¤šç§ç­›é€‰æ–¹å¼ï¼Œæ»¡è¶³ä¸åŒæŠ•èµ„éœ€æ±‚
- **æ™ºèƒ½æ•°æ®è·å–**: æŒ‰éœ€è·å–ï¼Œç¼“å­˜ä¼˜åŒ–ï¼Œæå‡æ‰§è¡Œæ•ˆç‡
- **è¯¦ç»†æ‰§è¡Œæ—¥å¿—**: å®Œæ•´è®°å½•æ‰§è¡Œè¿‡ç¨‹ï¼Œä¾¿äºé—®é¢˜è¯Šæ–­

### âœ… æ€§èƒ½ä¼˜åŒ–
- **åˆ†æ‰¹å¹¶å‘å¤„ç†**: é¿å…APIé™åˆ¶ï¼Œæå‡æ•°æ®è·å–é€Ÿåº¦
- **å¤šå±‚ç¼“å­˜ç­–ç•¥**: å‡å°‘é‡å¤æ•°æ®è·å–ï¼Œé™ä½æˆæœ¬
- **å‘é‡åŒ–è®¡ç®—**: åˆ©ç”¨pandasä¼˜åŒ–ï¼Œæå‡å› å­è®¡ç®—æ•ˆç‡

### âœ… ç”¨æˆ·ä½“éªŒ
- **ç›´è§‚çš„ç•Œé¢è®¾è®¡**: åˆ†æ­¥å¼•å¯¼ï¼Œé™ä½ä½¿ç”¨é—¨æ§›
- **å®æ—¶è¿›åº¦ç›‘æ§**: æ¸…æ™°æ˜¾ç¤ºæ‰§è¡ŒçŠ¶æ€å’Œè¿›åº¦
- **è¯¦ç»†çš„æ—¥å¿—æŸ¥çœ‹**: å¸®åŠ©ç”¨æˆ·äº†è§£æ‰§è¡Œç»†èŠ‚

### âœ… ç³»ç»Ÿå¯é æ€§
- **åˆ†å±‚é”™è¯¯å¤„ç†**: ä¼˜é›…å¤„ç†å„ç§å¼‚å¸¸æƒ…å†µ
- **ä¼˜é›…é™çº§æœºåˆ¶**: éƒ¨åˆ†å¤±è´¥ä¸å½±å“æ•´ä½“æ‰§è¡Œ
- **å®Œæ•´çš„ç›‘æ§ä½“ç³»**: å®æ—¶æŒæ¡ç³»ç»Ÿè¿è¡ŒçŠ¶æ€

### âœ… æ‰©å±•æ€§
- **æ’ä»¶åŒ–æ¶æ„**: æ”¯æŒè‡ªå®šä¹‰å› å­å’Œæ•°æ®æº
- **åˆ†å¸ƒå¼æ”¯æŒ**: å¯æ‰©å±•åˆ°å¤šæœºæ‰§è¡Œ
- **æ¨¡å—åŒ–è®¾è®¡**: ä¾¿äºåŠŸèƒ½è¿­ä»£å’Œç»´æŠ¤

è¿™å¥—æ¶æ„ä¸ºé‡åŒ–ç­–ç•¥æ‰§è¡Œæä¾›äº†å·¥ä¸šçº§çš„è§£å†³æ–¹æ¡ˆï¼Œæ—¢æ»¡è¶³äº†å½“å‰éœ€æ±‚ï¼Œåˆä¸ºæœªæ¥æ‰©å±•å¥ å®šäº†åšå®åŸºç¡€ï¼